<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (21) -->
<title>(WebPKI.org Support)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="generator" content="javadoc/DocFileWriter">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body class="doc-file-page">
<script type="text/javascript"></script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="../package-summary.html">Package</a></li>
<li>Class</li>
<li><a href="../../../../overview-tree.html">Tree</a></li>
<li><a href="../../../../help-doc.html#doc-file">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div id="navbar-sub-list"></div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main"><h2 id="1-encryption-support-heading">1. Encryption Support</h2>
The CBOR library contains support for <a href="../CBOREncrypter.html" title="class in org.webpki.cbor"><code>Encrypting</code></a> 
and <a href="../CBORDecrypter.html" title="class in org.webpki.cbor"><code>Decrypting</code></a>
arbitrary binary data using a specific scheme called
&quot;CBOR Encryption Format&quot; (CEF).
In similarity to <a href='signatures.html'>CSF</a>, 
CEF also depends on 
<a href='../package-summary.html#deterministic-encoding'>Deterministic&nbsp;Encoding</a>
which is used to create authentication data to content encryption
algorithms like GCM.
<p>
The following is a CEF object (here expressed in CBOR diagnostic notation), using the algorithms
<code>A256GCM</code> and <code>ECDH-ES+A256KW</code> for content- respectively key-wrapping:
</p>
<div class='webpkifloat'>
<div class='webpkibox'>
{<br>
<div style='height:0.5em'></div>&nbsp;&nbsp;<span style='color:grey'>/ Content encryption algorithm = A256GCM /</span><br>
&nbsp;&nbsp;1: 3,<br>
<div style='height:0.5em'></div>&nbsp;&nbsp;<span style='color:grey'>/ Key encryption object /</span><br>
&nbsp;&nbsp;2: {<br>
<div style='height:0.5em'></div>&nbsp;&nbsp;&nbsp;&nbsp;<span style='color:grey'>/ Key encryption algorithm = ECDH-ES+A256KW /</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;1: -31,<br>
<div style='height:0.5em'></div>&nbsp;&nbsp;&nbsp;&nbsp;<span style='color:grey'>/ Key Id /</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;3: "example.com:x25519",<br>
<div style='height:0.5em'></div>&nbsp;&nbsp;&nbsp;&nbsp;<span style='color:grey'>/ Ephemeral public key descriptor in COSE format /</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;7: {<br>
<div style='height:0.5em'></div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color:grey'>/ kty = OKP /</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1: 1,<br>
<div style='height:0.5em'></div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color:grey'>/ crv = X25519 /</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-1: 4,<br>
<div style='height:0.5em'></div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color:grey'>/ x /</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-2: h'c219e35a9c09bfcf1bd6c6dcd1e05ecb36cb6f465d9caeb101795e33fd7db112'<br>
&nbsp;&nbsp;&nbsp;&nbsp;},<br>
<div style='height:0.5em'></div>&nbsp;&nbsp;&nbsp;&nbsp;<span style='color:grey'>/ CipherText (Encrypted key) /</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;10: h'842916c5c81f8a815ec5ef2a472981b7300bc33fe748928c26e8c4dfff7a4747ecff9caea7040585'<br>
&nbsp;&nbsp;},<br>
<div style='height:0.5em'></div>&nbsp;&nbsp;<span style='color:grey'>/ Tag /</span><br>
&nbsp;&nbsp;8: h'84ad6926aa92d0de56e4674abf863390',<br>
<div style='height:0.5em'></div>&nbsp;&nbsp;<span style='color:grey'>/ Initialization Vector (IV) /</span><br>
&nbsp;&nbsp;9: h'c7cc6f77b9f984c15bc3cbeb',<br>
<div style='height:0.5em'></div>&nbsp;&nbsp;<span style='color:grey'>/ Ciphertext (Encrypted Content) /</span><br>
&nbsp;&nbsp;10: h'625c2b2a41907547b2210624e1e818991c00790aed16'<br>
}
</div>
</div>
<p>
The same object expressed as hex-encoded CBOR:
</p>
<div class='webpkihexbox'>
a5010302a401381e03726578616d706c652e636f6d3a78323535313907a301012004215820c219e35a9c09bfcf1bd6c6dcd1e05ecb36cb6f465d9caeb101795e33fd7db1120a5828842916c5c81f8a815ec5ef2a472981b7300bc33fe748928c26e8c4dfff7a4747ecff9caea7040585085084ad6926aa92d0de56e4674abf863390094cc7cc6f77b9f984c15bc3cbeb0a56625c2b2a41907547b2210624e1e818991c00790aed16
</div>
<p>
Decryption of this object using the private key (here in JWK format)
</p>
<div class='webpkifloat'>
<div class='webpkibox'>
{<br>
&nbsp;&nbsp;&quot;kid&quot;:&nbsp;&quot;example.com:x25519&quot;,<br>
&nbsp;&nbsp;&quot;kty&quot;:&nbsp;&quot;OKP&quot;,<br>
&nbsp;&nbsp;&quot;crv&quot;:&nbsp;&quot;X25519&quot;,<br>
&nbsp;&nbsp;&quot;x&quot;:&nbsp;&quot;6ZoM7yBYlJYNmxwFl4UT3MtCoTv7ztUjpRuKEXrV8Aw&quot;,<br>
&nbsp;&nbsp;&quot;d&quot;:&nbsp;&quot;cxfl86EVmcqrR07mWENCf1F_5Ni5mt1ViGyERB6Q1vA&quot;<br>
}
</div>
</div>
should return the UTF-8 encoded string <code>&quot;Hello encrypted world!&quot;</code>.
<h2 id='parameters'>2. Encryption Container</h2>
<p>
The following figure shows the layout of CEF objects:
</p>
<div class='webpkifloat'>
<div class='webpkisvg'>
<img src='cbor-crypto.svg' alt='CEF object layout' style='height:20em;padding:0.2em 0.6em'/>
</div>
</div>
The numbers in paranthesis denote the actual label (map key) value.
<h3 id='cef-content-encyption-map'>2.1. Content Encryption Map</h3>
The following table shows the function and type of each element of content encryption maps:
<div class='webpkifloat'>
<table class='webpkitable'>
<tr><th>Name</th><th>Label</th><th>Argument</th><th style='min-width:30em'>Description</th></tr>

<tr><td><code class='webpkicode'>customData</code></td><td style='text-align:center'><code>0</code></td>
<td style='text-align:center'>&quot;<i>Any</i>&quot;</td><td><i>Optional</i>: data included (in clear) in the CEF container.
Also see <a href='crypto-options.html'>Crypto Options</a>.</td></tr>

<tr><td><code class='webpkicode'>algorithm</code></td><td style='text-align:center'><code>1</code></td>
<td style='text-align:center'><code>int</code></td><td>Content encryption algorithm using 
<a href='#cef-content-encryption-algorithms'>COSE&nbsp;identifiers</a>.</td></tr>

<tr><td><code class='webpkicode'>keyEncryption</code></td><td style='text-align:center'><code>2</code></td>
<td style='text-align:center'><code>map</code></td>
<td><i>Optional</i>: Key encryption parameters.</td></tr>

<tr><td><code class='webpkicode'>keyId</code></td><td style='text-align:center'><code>3</code></td>
<td style='text-align:center'>&quot;<i>Any</i>&quot;</td>
<td><i>Optional</i>: key identifier using any valid CBOR object. 
Note that <code class='webpkicode'>keyId</code> <b>must not</b> be used together with the
<code class='webpkicode'>keyEncryption</code> option.
A compliant <code class='webpkicode'>keyId</code>
<b>must</b> uniquely identify a specific signature key.</td></tr>

<tr><td><code class='webpkicode'>tag</code></td><td style='text-align:center'><code>8</code></td>
<td style='text-align:center'><code>bstr</code></td>
<td>Authentication Tag.</td></tr>

<tr><td><code class='webpkicode'>iv</code></td><td style='text-align:center'><code>9</code></td>
<td style='text-align:center'><code>bstr</code></td><td>Initialization Vector (IV).</td></tr>

<tr><td><code class='webpkicode'>cipherText</code></td><td style='text-align:center'><code>10</code></td>
<td style='text-align:center'><code>bstr</code></td><td>Encrypted content.
</td></tr>
</table>
</div>
<h3 id='cef-key-encyption-map'>2.2. Key Encryption Map</h3>
The following table shows the function and type of each element of key encryption maps:
<div class='webpkifloat'>
<table class='webpkitable'>
<tr><th>Name</th><th>Label</th><th>Argument</th><th style='min-width:30em'>Description</th></tr>

<tr><td><code class='webpkicode'>algorithm</code></td><td style='text-align:center'><code>1</code></td>
<td style='text-align:center'><code>int</code></td><td>Key encryption algorithm using 
<a href='#cef-key-encryption-algorithms'>COSE&nbsp;identifiers</a>.</td></tr>

<tr><td><code class='webpkicode'>keyId</code></td><td style='text-align:center'><code>3</code></td>
<td style='text-align:center'>&quot;<i>Any</i>&quot;</td><td><i>Optional</i>: key identifier using 
any valid CBOR object. 
Note that <code class='webpkicode'>keyId</code> <b>must not</b> be used together with 
<code class='webpkicode'>publicKey</code> or <code class='webpkicode'>certificatePath</code>.
A compliant <code class='webpkicode'>keyId</code> <b>must</b> uniquely identify a specific key encryption key.
</td></tr>

<tr><td><code class='webpkicode'>publicKey</code></td><td style='text-align:center'><code>4</code></td>
<td style='text-align:center'><code>map</code></td>
<td><i>Optional</i>: public key in COSE format.  
Note that public key objects <b>must not</b> contain additional information like
key identifiers or preferred algorithms.
</td></tr>

<tr><td><code class='webpkicode'>certificatePath</code></td><td style='text-align:center'><code>5</code></td>
<td style='text-align:center'><code>array</code></td><td><i>Optional</i>: certificate path supplied 
as an array of <code>byte&nbsp;string</code> objects holding X.509 certificates in DER format, 
where the first object <b>must</b> be the encryption certificate.
Key encryption objects <b>must not</b> contain both <code class='webpkicode'>certificatePath</code>
and <code class='webpkicode'>publicKey</code> elements.
</td></tr>

<tr><td><code class='webpkicode'>ephemeralKey</code></td><td style='text-align:center'><code>7</code></td>
<td style='text-align:center'><code>map</code></td>
<td><i>Optional</i>: public key in COSE format.  Used by ECDH algorithms.
</td></tr>

<tr><td><code class='webpkicode'>cipherText</code></td><td style='text-align:center'><code>10</code></td>
<td style='text-align:center'><code>bstr</code></td>
<td><i>Optional</i>: Encrypted key. Used by key-wrapping algorithms.</td></tr>
</table>
</div>
<h2 id='cef-decryption-process'>3. Decryption Process</h2>
This section describes the steps needed to decrypt a CEF object
(encryption is performed by reversing the process by generating and writing data).
<p>
Begin by defining the variables 
<code class='webpkivar'>contentEncryptionAlgorithm</code>,
<code class='webpkivar'>contentEncryptionKey</code>, and
<code class='webpkivar'>additionalAuthenticationData</code>.
</p>
<h3 id='cef-get-content-encryption-algorithm'>3.1 Get Content Encryption Algorithm</h3>
Perform the following steps:
<ol>
    <li class='webpkilistspacing'>Decode 
        the <a href='#cef-content-encyption-map'>Content&nbsp;Encryption&nbsp;Map</a>.</li>
    <li class='webpkilistspacing'>Set 
        <code class='webpkivar'>contentEncryptionAlgorithm = </code><code class='webpkicode'>algorithm</code>.</li>
</ol>
<h3 id='cef-recover-content-encryption-key'>3.2 Recover Content Encryption Key</h3>
For key encryption schemes (= having a
<code class='webpkicode'>keyEncryption</code> attribute), perform the following steps:
<ol>
    <li class='webpkilistspacing'>Decode the <a href='#cef-key-encyption-map'>Key&nbsp;Encryption&nbsp;Map</a>.</li>
    <li class='webpkilistspacing'>Determine the <code class='webpkivar'>privateKey</code> to use.
        Private keys are either <i>implicit</i>,
        or are identified through a
        <code class='webpkicode'>keyId</code>, 
        <code class='webpkicode'>publicKey</code>, or
        <code class='webpkicode'>certificatePath</code> attribute.
    </li>
    <li>Recover the <code class='webpkivar'>contentEncryptionKey</code> by applying
    the <code class='webpkicode'>algorithm</code>,
    <code class='webpkicode'>ephemeralKey</code>,
    <code class='webpkicode'>cipherText</code>, and
    the previously located <code class='webpkivar'>privateKey</code> to an associated key decryption method, 
    while using the <code class='webpkivar'>contentEncryptionAlgorithm</code>
    to get the expected length of the key.</li>
</ol>
For symmetric-key schemes only, the <code class='webpkivar'>contentEncryptionKey</code> is
either <i>implicit</i> or is located through a <code class='webpkicode'>keyId</code> attribute.
<h3 id='cef-decrypt-content'>3.3. Decrypt Content</h3>
<p>
Finalize the decryption process by performing the following steps:
</p>
<ol>
<li class='webpkilistspacing'>Read and save the <code class='webpkicode'>tag</code>,
<code class='webpkicode'>iv</code>, and <code class='webpkicode'>ciphertext</code>
attributes from the <a href='#cef-content-encyption-map'>Content&nbsp;Encryption&nbsp;Map</a>.</li>
<li class='webpkilistspacing'>Remove the <code class='webpkicode'>tag</code>,
<code class='webpkicode'>iv</code>, and <code class='webpkicode'>ciphertext</code> attributes from the
<a href='#cef-content-encyption-map'>Content&nbsp;Encryption&nbsp;Map</a>.
Note that the top level <code>map</code> object <b>must</b> be updated
as well to reflect the changed number of elements.
<li class='webpkilistspacing'>Serialize the remaining CBOR object
(including the optional <a href='#cef-key-encyption-map'>Key&nbsp;Encryption&nbsp;Map</a>),
and assign the result to the
<code class='webpkivar'>additionalAuthenticationData</code> (<code>AAD</code>) variable.</li>
<li>Apply the <code class='webpkivar'>contentEncryptionAlgorithm</code>
(in decrypt mode) to the recovered <code class='webpkivar'>contentEncryptionKey</code>,
the attributes read in the step #1,
and the <code class='webpkivar'>additionalAuthenticationData</code>.</li>
</ol>
The result from step #4 is the decrypted content.
<h2 id="4-algorithms-heading">4. Algorithms</h2>
<h3 id='cef-kdf'>4.1. Key Derivation Function (KDF)</h3>
ECDH based key encryption schemes <b>must</b> use a Key Derivation Function (KDF) according to
HKDF [<a href='https://www.rfc-editor.org/rfc/rfc5869.html'>RFC&nbsp;5869</a>], profiled as follows:
<ul>
<li class='webpkilistspacing'><code>hmac</code>: The HKDF implementation <b>must</b> use HMAC with SHA-256</li>
<li class='webpkilistspacing'><code>salt</code>: N/A. The default extract mode handling <b>must</b> be implemented.</li>
<li><code>info</code>: This parameter <b>must</b> consist of the actual
COSE key encryption algorithm,
expressed as a 32-bit (4 byte) signed big-endian integer.</li>
</ul>
<h3 id='cef-content-encryption-algorithms'>4.2. Content Encryption Algorithms</h3>
<div>
Currently supported content encryption algorithms:
</div>
<div class='webpkifloat'>
<table class='webpkitable'>
<tr><th>Name</th><th>Identifier</th><th>Compatibility</th></tr>
<tr style='text-align:center'><td><code>A128GCM</code></td><td>1</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>A192GCM</code></td><td>2</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>A256GCM</code></td><td>3</td><td>COSE, JOSE</td></tr>
<tr style='text-align:center'><td><code>A128CBC-HS256</code></td><td>200</td><td>JOSE</td></tr>
<tr style='text-align:center'><td><code>A192CBC-HS384</code></td><td>201</td><td>JOSE</td></tr>
<tr style='text-align:center'><td><code>A256CBC-HS512</code></td><td>202</td><td>JOSE</td></tr>
</table>
</div>
<h3 id='cef-key-encryption-algorithms' style='margin-top:0.5em'>4.3. Key Encryption Algorithms</h3>
<div>
Currently supported key encryption algorithms:
</div>
<div class='webpkifloat'>
<table class='webpkitable'>
<tr><th>Name</th><th>Identifier</th><th>Compatibility</th><th>Notes</th></tr>
<tr style='text-align:center'><td><code>ECDH-ES</code></td><td>-25</td><td>COSE, JOSE</td><td>1, 2</td></tr>
<tr style='text-align:center'><td><code>ECDH-ES+A128KW</code></td><td>-29</td><td>COSE, JOSE</td><td>1, 2</td></tr>
<tr style='text-align:center'><td><code>ECDH-ES+A192KW</code></td><td>-30</td><td>COSE, JOSE</td><td>1, 2</td></tr>
<tr style='text-align:center'><td><code>ECDH-ES+A256KW</code></td><td>-31</td><td>COSE, JOSE</td><td>1, 2</td></tr>
<tr style='text-align:center'><td><code>RSA-OAEP</code></td><td>-40</td><td>COSE, JOSE</td><td>3</td></tr>
<tr style='text-align:center'><td><code>RSA-OAEP-256</code></td><td>-41</td><td>COSE, JOSE</td><td>3</td></tr>
</table>
</div>
Notes:
<ol>
    <li class='webpkilistspacing'>CEF and COSE use different profiles for 
     the <a href='#cef-kdf'>Key&nbsp;Derivation&nbsp;Function&nbsp;(KDF)</a>.</li>
    <li class='webpkilistspacing'>Supported key types: <code>P-256</code>, <code>P-384</code>, <code>P-521</code>,
        <code>X25519</code>, and <code>X448</code>.</li>
    <li>Supported key lengths: <code>2048</code>, <code>3072</code>, and <code>4096</code></li>
</ol>
<h2 id="5-tagged-and-custom-encryption-data-heading">5. Tagged and Custom Encryption Data</h2>
The CEF container can be enhanced through a couple of options
described in <a href='crypto-options.html'>Crypto Options</a>.
Such options are included in the data to be authenticated. 
<h2 id="6-test-vectors-heading">6. Test Vectors</h2>
An extensive set of test vectors is currently available at: 
<a href='https://github.com/cyberphone/openkeystore/tree/master/testdata/cbor-encryption'>
https://github.com/cyberphone/openkeystore/tree/master/testdata/cbor-encryption
</a>.
<p>
Use <a href="../../tools/CBORPrinter.html" title="class in org.webpki.tools"><code>CBORPrinter</code></a> to list contents in a human-friendly way.
</p>
<h2 id='api-example'>7. Using the Encryption API</h2>
The following section outlines how the encryption API is supposed to be used.
<p>
Sample program:
</p>
<div class='webpkifloat'>
<div class='webpkibox'>
package&nbsp;cbor_api_demo;<br><br>import&nbsp;java.security.KeyPair;<br>import&nbsp;java.security.PrivateKey;<br>import&nbsp;java.security.PublicKey;<br><br>import&nbsp;org.webpki.cbor.CBORAsymKeyDecrypter;<br>import&nbsp;org.webpki.cbor.CBORAsymKeyEncrypter;<br>import&nbsp;org.webpki.cbor.CBORKeyPair;<br>import&nbsp;org.webpki.cbor.CBORDecoder;<br><br>import&nbsp;org.webpki.crypto.ContentEncryptionAlgorithms;<br>import&nbsp;org.webpki.crypto.KeyEncryptionAlgorithms;<br><br>import&nbsp;org.webpki.util.HexaDecimal;<br>import&nbsp;org.webpki.util.UTF8;<br><br>public&nbsp;class&nbsp;EncryptionDemo&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Message&nbsp;encoded&nbsp;in&nbsp;UTF-8.<br>&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;final&nbsp;byte[]&nbsp;SECRET_MESSAGE&nbsp;=&nbsp;UTF8.encode("A&nbsp;very&nbsp;secret&nbsp;message");<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;X25519&nbsp;private&nbsp;key&nbsp;in&nbsp;COSE&nbsp;format.<br>&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;final&nbsp;byte[]&nbsp;X25519_PRIVATE_KEY&nbsp;=&nbsp;HexaDecimal.decode(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"a401012004215820e99a0cef205894960d9b1c05978513dccb"&nbsp;+<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"42a13bfbced523a51b8a117ad5f00c2358207317e5f3a11599"&nbsp;+<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"caab474ee65843427f517fe4d8b99add55886c84441e90d6f0");<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;void&nbsp;main(String[]&nbsp;args)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Get&nbsp;keys&nbsp;in&nbsp;Java&nbsp;format.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KeyPair&nbsp;keyPair&nbsp;=&nbsp;CBORKeyPair.convert(CBORDecoder.decode(X25519_PRIVATE_KEY));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrivateKey&nbsp;receiverKey&nbsp;=&nbsp;keyPair.getPrivate();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PublicKey&nbsp;senderKey&nbsp;=&nbsp;keyPair.getPublic();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Encrypt&nbsp;data&nbsp;using&nbsp;CEF.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]&nbsp;encryptionObject&nbsp;=&nbsp;new&nbsp;CBORAsymKeyEncrypter(senderKey,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KeyEncryptionAlgorithms.ECDH_ES,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ContentEncryptionAlgorithms.A256GCM)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.encrypt(SECRET_MESSAGE).encode();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Decrypt&nbsp;data&nbsp;using&nbsp;CEF.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]&nbsp;decryptedData&nbsp;=&nbsp;new&nbsp;CBORAsymKeyDecrypter(receiverKey)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.decrypt(CBORDecoder.decode(encryptionObject));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Assume&nbsp;that&nbsp;the&nbsp;data&nbsp;is&nbsp;a&nbsp;string&nbsp;encoded&nbsp;in&nbsp;UTF-8.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;secretMessage&nbsp;=&nbsp;UTF8.decode(decryptedData);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(secretMessage);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>}<br>
</div>
</div>
<p>
Sample key in diagnostic notation:
</p>
<div class='webpkifloat'>
<div class='webpkibox'>
{<br>&nbsp;&nbsp;1:&nbsp;1,<br>&nbsp;&nbsp;-1:&nbsp;4,<br>&nbsp;&nbsp;-2:&nbsp;h'e99a0cef205894960d9b1c05978513dccb42a13bfbced523a51b8a117ad5f00c',<br>&nbsp;&nbsp;-4:&nbsp;h'7317e5f3a11599caab474ee65843427f517fe4d8b99add55886c84441e90d6f0'<br>}
</div>
</div>
<p>
The resulting encryption object in diagnostic notation:
</p>
<div class='webpkifloat'>
<div class='webpkibox'>
{<br>&nbsp;&nbsp;1:&nbsp;3,<br>&nbsp;&nbsp;2:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;-25,<br>&nbsp;&nbsp;&nbsp;&nbsp;7:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;1,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-1:&nbsp;4,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-2:&nbsp;h'3e9c03b4e2ccb023272fe0f1a5a414645a7e5a0952a3da8199ba46812603ee1a'<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;},<br>&nbsp;&nbsp;8:&nbsp;h'4ac80be51285309b93b8f4cc38f6b8ba',<br>&nbsp;&nbsp;9:&nbsp;h'9fbd6e151bad2af177dd3382',<br>&nbsp;&nbsp;10:&nbsp;h'115b48dcffcf88dce70b2173d6c368b2cfe802521c'<br>}
</div>
</div>
<p>
The resulting encryption object expressed in hexadecimal:
</p>
<div class='webpkihexbox'>
a5010302a201381807a3010120042158203e9c03b4e2ccb023272fe0f1a5a414645a7e5a0952a3da8199ba46812603ee1a08504ac80be51285309b93b8f4cc38f6b8ba094c9fbd6e151bad2af177dd33820a55115b48dcffcf88dce70b2173d6c368b2cfe802521c
</div></main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small><i>2005-2024 WebPKI.org.</i></small></p>
</footer>
</div>
</div>
</body>
</html>
